<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="robots" content="noindex">
    <title>BlinkAI - 專為粉絲打造的 AI 知識庫與助理</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
    <!-- 引入 Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* ------------------------- 共同樣式 ------------------------- */
        body {
            font-family: 'Lato', sans-serif;
            background-color: #111827;
            color: #d1d5db;
            transition: background-color 0.3s;
            overflow-x: hidden; /* 防止水平捲動 */
            /* 確保在切換視圖時不會有頂部/底部問題 */
            min-height: 100vh;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
        }

        /* 主色調 - BLACKPINK 粉色 */
        .text-primary { color: #f472b6; }
        .bg-primary { background-color: #f472b6; }
        .border-primary { border-color: #f472b6; }

        /* 次要色調 - 淺粉色 */
        .text-secondary { color: #f9a8d4; }
        .bg-secondary { background-color: #f9a8d4; }

        /* 背景漸層 */
        .gradient-bg {
            background: linear-gradient(180deg, #111827 0%, #1f2937 100%);
        }

        /* 玻璃擬態效果 */
        .glass-card {
            background: rgba(31, 41, 55, 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* 區塊標題 */
        .section-title {
            @apply text-3xl md:text-4xl font-bold text-center mb-4;
            color: #f9a8d4;
        }
        .section-subtitle {
            @apply text-lg md:text-xl text-gray-400 text-center max-w-2xl mx-auto mb-12 px-4;
        }

        /* 導航欄 */
        nav {
            background: rgba(17, 24, 39, 0.9);
            backdrop-filter: blur(10px);
        }

        /* 按鈕樣式 */
        .btn {
            @apply px-6 py-3 rounded-full font-bold text-lg transition-all duration-300 inline-block cursor-pointer select-none;
        }
        .btn-primary {
            @apply bg-primary text-gray-900;
        }
        .btn-primary:hover {
            @apply bg-secondary scale-105;
        }

        /* 強調按鈕樣式 (帶光暈) */
        .btn-glow {
            @apply bg-primary text-gray-900 shadow-lg shadow-pink-500/40;
            animation: glow-pulse 2s infinite;
        }
        .btn-glow:hover {
            @apply bg-secondary shadow-pink-500/60 scale-105;
            animation: none;
        }
        @keyframes glow-pulse {
            0% { box-shadow: 0 0 0 0 rgba(244, 114, 182, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(244, 114, 182, 0); }
            100% { box-shadow: 0 0 0 0 rgba(244, 114, 182, 0); }
        }

        .btn-outline {
            @apply bg-transparent border-2 border-primary text-primary;
        }
        .btn-outline:hover {
            @apply bg-primary text-gray-900 scale-105;
        }

        /* 明顯的邊框按鈕 (用於聯繫我們) */
        .btn-outline-bright {
            @apply bg-transparent border-2 border-gray-300 text-white;
        }
        .btn-outline-bright:hover {
            @apply border-primary text-primary shadow-[0_0_15px_rgba(244,114,182,0.5)];
        }

        /* 團隊成員按鈕樣式 */
        .btn-team {
            @apply bg-gray-800 border border-pink-500 text-pink-400 rounded-full px-6 py-2 text-sm transition-all duration-300;
        }
        .btn-team:hover {
            @apply bg-pink-500 text-white shadow-lg shadow-pink-500/50 -translate-y-1;
        }

        /* --- LINE 按鈕樣式 --- */
        .btn-line {
            background-color: #06C755;
            color: white;
        }
        .btn-line:hover {
            background-color: #05b34c;
            transform: scale(1.05);
            box-shadow: 0 10px 15px -3px rgba(6, 199, 85, 0.3);
        }

        /* 特色卡片 */
        .feature-card {
            @apply glass-card p-6 md:p-8 rounded-2xl flex flex-col items-center text-center transition-all duration-300;
        }
        .feature-card:hover {
            transform: translateY(-5px);
            border-color: #f472b6;
        }
        .feature-card .icon {
            @apply text-4xl md:text-5xl mb-4 md:mb-6;
            color: #f472b6;
        }

        /* 輸入框樣式 (用於註冊頁) */
        .input-field {
            @apply w-full bg-gray-800/50 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-colors;
        }

        /* ------------------------- CANVAS 相關樣式 ------------------------- */

        #hero-header {
            background-color: #111827; /* 基礎背景色 */
            box-shadow: inset 0 -100px 50px -50px #111827;
            position: relative; /* 確保 Canvas 絕對定位在其內 */
        }

        /* 確保 Canvas 佈滿容器 */
        #heroCanvas {
            display: block;
            filter: brightness(0.7); /* 降低亮度，讓文字更突出 */
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        /* ------------------------- 聊天室樣式 ------------------------- */
        .chat-bubble {
            /* 加入 w-fit 讓寬度隨文字變化，break-words 防止長單字破版 */
            @apply p-3 md:p-4 rounded-2xl w-fit max-w-[85%] md:max-w-lg transition-all duration-300 text-sm md:text-base break-words;
        }
        .user-bubble {
            @apply bg-gray-700 text-white rounded-br-none ml-auto;
        }
        .ai-bubble {
            @apply bg-primary text-gray-900 rounded-bl-none mr-auto;
        }
        .ai-bubble-error {
            @apply !bg-red-500 !text-white;
        }
        .ai-bubble .source {
            @apply mt-2 md:mt-3 pt-2 md:pt-3 border-t border-pink-800/30 text-xs md:text-sm text-gray-800;
        }
        .ai-bubble .source-title {
            @apply font-bold;
        }

        /* 載入動畫 */
        .loading-dots span {
            @apply w-2 h-2 bg-gray-400 rounded-full inline-block;
            animation: bounce 1.4s infinite both;
        }
        .loading-dots span:nth-child(1) { animation-delay: -0.32s; }
        .loading-dots span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }

        /* ------------------------- LINE 模式樣式 ------------------------- */
        body.line-mode {
            background-color: #f0f0f0;
            height: 100dvh;
            overflow: hidden;
        }
        /* 將聊天容器擴展至全螢幕 */
        .line-mode #chat-assistant .glass-card {
            background: #8c9eff; /* LINE 經典藍背景 */
            border: none;
            border-radius: 0;
            height: 100dvh !important;
            max-height: 100dvh;
            width: 100%;
        }
        .line-mode #chat-assistant {
            padding: 0 !important;
            height: 100dvh;
        }
        .line-mode .user-bubble {
            background-color: #96f26d !important; /* LINE 綠 */
            color: black !important;
            border-radius: 18px;
            border-top-right-radius: 2px;
            margin-left: auto;
        }
        .line-mode .ai-bubble {
            background-color: white !important;
            color: black !important;
            border-radius: 18px;
            border-top-left-radius: 2px;
            margin-right: auto;
        }
        .line-mode .chat-header {
            background-color: #2c3e50 !important;
            color: white;
            border-bottom: none;
            padding-top: max(0.75rem, env(safe-area-inset-top)); /* 避開瀏海 */
            display: flex;
            align-items: center;
        }
        .line-mode #chat-form {
            background-color: white !important;
            padding-bottom: max(1rem, env(safe-area-inset-bottom)); /* 避開底部橫條 */
        }
        .line-mode #chat-input {
            background-color: #f3f4f6;
            color: black;
        }
        .line-mode #send-button {
            background-color: #2563eb;
            color: white;
        }
        .line-mode .source {
            border-top-color: #eee;
            color: #666;
        }
        .line-mode #web-nav-controls {
            display: none;
        }

        /* 手機選單動畫 */
        #mobile-menu {
            transition: max-height 0.3s ease-in-out, opacity 0.3s ease-in-out;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }
        #mobile-menu.open {
            max-height: 400px;
            opacity: 1;
        }
    </style>
</head>
<body class="antialiased">

    <!-- 1. 官網視圖 (Landing Page) -->
    <div id="landing-page" class="flex flex-col flex-1">
        <!-- 導航欄 -->
        <nav class="sticky top-0 z-50 w-full shadow-lg">
            <div class="container mx-auto px-4 md:px-6 py-4">
                <div class="flex justify-between items-center">
                    <h1 class="text-2xl md:text-3xl font-bold text-primary z-50">BlinkAI</h1>
                    <!-- 電腦版選單 -->
                    <div class="hidden md:flex space-x-6 items-center">
                        <a href="#problem" class="text-gray-300 hover:text-primary transition">市場痛點</a>
                        <a href="#personas" class="text-gray-300 hover:text-primary transition">目標客群</a>
                        <a href="#solution" class="text-gray-300 hover:text-primary transition">解決方案</a>
                        <a href="#tech" class="text-gray-300 hover:text-primary transition">核心技術</a>
                        <a href="#line-integration" class="text-gray-300 hover:text-[#06C755] transition"><i class="fa-brands fa-line"></i> LINE 服務</a>
                        <a href="#team" class="text-gray-300 hover:text-primary transition">團隊</a>
                        <a href="#pricing" class="text-gray-300 hover:text-primary transition">定價方案</a>
                        <a href="#" onclick="showChatView(); return false;" class="btn btn-primary !px-5 !py-2 !text-base">搶先體驗</a>
                    </div>

                    <!-- 手機版漢堡按鈕 -->
                    <button id="menu-btn" class="md:hidden text-white text-2xl focus:outline-none z-50" onclick="toggleMobileMenu()">
                        <i class="fa-solid fa-bars"></i>
                    </button>
                </div>

                <!-- 手機版下拉選單 -->
                <div id="mobile-menu" class="md:hidden absolute top-full left-0 w-full bg-gray-900/95 backdrop-blur-xl border-b border-gray-700 shadow-2xl">
                    <div class="flex flex-col p-6 space-y-4 text-center">
                        <a href="#problem" onclick="toggleMobileMenu()" class="text-lg text-gray-300 hover:text-primary py-2">市場痛點</a>
                        <a href="#personas" onclick="toggleMobileMenu()" class="text-lg text-gray-300 hover:text-primary py-2">目標客群</a>
                        <a href="#solution" onclick="toggleMobileMenu()" class="text-lg text-gray-300 hover:text-primary py-2">解決方案</a>
                        <a href="#tech" onclick="toggleMobileMenu()" class="text-lg text-gray-300 hover:text-primary py-2">核心技術</a>
                        <a href="#line-integration" onclick="toggleMobileMenu()" class="text-lg text-gray-300 hover:text-[#06C755] py-2"><i class="fa-brands fa-line"></i> LINE 服務</a>
                        <a href="#team" onclick="toggleMobileMenu()" class="text-lg text-gray-300 hover:text-primary py-2">團隊</a>
                        <a href="#pricing" onclick="toggleMobileMenu()" class="text-lg text-gray-300 hover:text-primary py-2">定價方案</a>
                        <a href="#" onclick="showChatView(); toggleMobileMenu(); return false;" class="btn btn-primary !w-full mt-2">搶先體驗</a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Hero 區塊 (已整合 Canvas 粒子背景) -->
        <header id="hero-header" class="relative min-h-[80vh] flex items-center">
            <!-- 1. Canvas 元素 (作為背景，絕對定位) -->
            <canvas id="heroCanvas" class="absolute inset-0 z-0"></canvas>

            <!-- 2. 內容層 (相對定位，z-index 確保在 Canvas 上方) -->
            <div class="container mx-auto px-4 md:px-6 py-20 md:py-48 text-center text-white relative z-10">
                <h1 class="text-5xl md:text-7xl font-extrabold mb-6 leading-tight">BlinkAI</h1>
                <p class="text-xl md:text-3xl font-light mb-10 md:mb-12 text-secondary px-2">為準確性與互動參與而生的專精 AI 平台</p>
                <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
                    <a href="#" onclick="showChatView(); return false;" class="btn btn-glow !text-lg md:!text-xl !py-3 md:!py-4 !px-8 hover:scale-105 transition-all duration-500 w-full sm:w-auto">搶先試用 AI 助理</a>
                </div>
            </div>
        </header>

        <!-- 市場痛點 (The Problem) -->
        <section id="problem" class="py-16 md:py-24 gradient-bg">
            <div class="container mx-auto px-4 md:px-6">
                <h2 class="section-title">粉絲資訊的危機</h2>
                <p class="section-subtitle">K-pop 的爆炸性增長創造了一個龐大但混亂的數據生態系統。粉絲在獲取可信資訊時，正面臨前所未有的挑戰。</p>
                <div class="grid md:grid-cols-3 gap-6 md:gap-8">
                    <!-- 痛點 1 -->
                    <div class="feature-card">
                        <div class="icon"><i class="fa-solid fa-circle-exclamation"></i></div>
                        <h3 class="text-xl md:text-2xl font-bold text-white mb-3 md:mb-4">資訊過載與錯誤</h3>
                        <p class="text-gray-300 text-sm md:text-base">網路充斥著粉絲猜測、錯誤翻譯和過時內容。事實與謠言混雜，導致粉絲對關鍵事件產生認知混淆。</p>
                    </div>
                    <!-- 痛點 2 -->
                    <div class="feature-card">
                        <div class="icon"><i class="fa-solid fa-robot"></i></div>
                        <h3 class="text-xl md:text-2xl font-bold text-white mb-3 md:mb-4">通用 AI 的「幻覺」</h3>
                        <p class="text-gray-300 text-sm md:text-base">通用 AI 為了回答問題，會捏造事實（例如：Lisa 是隊長、虛構的巡演日期），對尋求準確資訊的粉絲造成嚴重困擾。</p>
                    </div>
                    <!-- 痛點 3 -->
                    <div class="feature-card">
                        <div class="icon"><i class="fa-solid fa-baby"></i></div>
                        <h3 class="text-xl md:text-2xl font-bold text-white mb-3 md:mb-4">新粉絲的高門檻</h3>
                        <p class="text-gray-300 text-sm md:text-base">"Baby Blinks" 難以快速區分官方事實與粉絲理論。入坑的學習曲線陡峭，且在社群中提問時可能面臨壓力。</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 用戶畫像 (Personas) -->
        <section id="personas" class="py-16 md:py-24">
            <div class="container mx-auto px-4 md:px-6">
                <h2 class="section-title">為每一種粉絲而生</h2>
                <p class="section-subtitle">無論你是剛入坑的新粉，還是資深內容創作者，BlinkAI 都能提供你需要的價值。</p>
                <div class="grid md:grid-cols-3 gap-6 md:gap-8">
                    <!-- Persona 1 -->
                    <div class="glass-card p-6 md:p-8 rounded-2xl transition-all duration-300 hover:border-primary">
                        <img src="https://placehold.co/200x200/1f2937/f472b6?text=Jenny"
                            alt="[新粉絲 Jenny]"
                            class="w-20 h-20 md:w-24 md:h-24 rounded-full mx-auto mb-6 border-4 border-primary object-cover">
                        <h3 class="text-xl md:text-2xl font-bold text-white text-center mb-2">Jenny (19)</h3>
                        <p class="text-center text-gray-400 mb-4">Baby Blink</p>
                        <p class="text-gray-300 text-sm md:text-base"><strong class="text-secondary">痛點：</strong>資訊混亂，怕問「笨問題」。</p>
                        <p class="text-gray-300 text-sm md:text-base mt-2"><strong class="text-secondary">需要：</strong>安全、準確的 24/7 嚮導。</p>
                    </div>
                    <!-- Persona 2 -->
                    <div class="glass-card p-6 md:p-8 rounded-2xl transition-all duration-300 hover:border-primary">
                        <img src="https://images.unsplash.com/photo-1557862921-3e16092bb49c?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&q=80&w=400"
                            alt="[創作者 Alex]"
                            class="w-20 h-20 md:w-24 md:h-24 rounded-full mx-auto mb-6 border-4 border-primary object-cover"
                            onerror="this.onerror=null;this.src='https://placehold.co/200x200/1f2937/f472b6?text=Alex';">
                        <h3 class="text-xl md:text-2xl font-bold text-white text-center mb-2">Alex (28)</h3>
                        <p class="text-center text-gray-400 mb-4">創作者</p>
                        <p class="text-gray-300 text-sm md:text-base"><strong class="text-secondary">痛點：</strong>查核事實耗時費力。</p>
                        <p class="text-gray-300 text-sm md:text-base mt-2"><strong class="text-secondary">需要：</strong>可信賴的單一事實來源。</p>
                    </div>
                    <!-- Persona 3 -->
                    <div class="glass-card p-6 md:p-8 rounded-2xl transition-all duration-300 hover:border-primary">
                        <img src="https://images.unsplash.com/photo-1507591064343-9af923e232b7?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&q=80&w=400"
                            alt="[媒體人 Bob]"
                            class="w-20 h-20 md:w-24 md:h-24 rounded-full mx-auto mb-6 border-4 border-primary object-cover"
                            onerror="this.onerror=null;this.src='https://placehold.co/200x200/1f2937/f472b6?text=Bob';">
                        <h3 class="text-xl md:text-2xl font-bold text-white text-center mb-2">Bob (45)</h3>
                        <p class="text-center text-gray-400 mb-4">記者</p>
                        <p class="text-gray-300 text-sm md:text-base"><strong class="text-secondary">痛點：</strong>通用 AI 數據不可用。</p>
                        <p class="text-gray-300 text-sm md:text-base mt-2"><strong class="text-secondary">需要：</strong>商業級 AI 查詢引擎。</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 解決方案 (The Solution) -->
        <section id="solution" class="py-16 md:py-24 gradient-bg">
            <div class="container mx-auto px-4 md:px-6">
                <div class="grid md:grid-cols-2 gap-10 md:gap-16 items-center">
                    <div>
                        <img src="https://placehold.co/800x600/1f2937/f472b6?text=Solution"
                            alt="[解決方案示意圖]"
                            class="rounded-2xl shadow-2xl w-full">
                    </div>
                    <div>
                        <h2 class="text-3xl md:text-4xl font-bold text-secondary mb-4 md:mb-6">我們的創新解決方案：BlinkAI</h2>
                        <h3 class="text-xl md:text-2xl font-semibold text-white mb-3 md:mb-4">專精領域 AI 助理</h3>
                        <p class="mb-4 text-gray-300 text-sm md:text-base">BlinkAI 是一個專精領域的 AI 助理。我們不使用通用的網路資訊，而是建立了一個「BLACKPINK 官方知識庫」，確保資訊的絕對純淨。</p>
                        <h3 class="text-xl md:text-2xl font-semibold text-white mb-3 md:mb-4">RAG 核心技術</h3>
                        <p class="mb-4 text-gray-300 text-sm md:text-base">核心技術 RAG (檢索增強生成)，能確保 AI 的每一個回答都有「事實依據」，從根本上杜絕「幻覺」和「粉絲猜測」。</p>
                        <h3 class="text-xl md:text-2xl font-semibold text-white mb-3 md:mb-4">平台特性</h3>
                        <p class="text-gray-300 mb-6 text-sm md:text-base">這是一個為全球 Blinks 打造的、7x24 小時、多平台（Web, Discord, LINE）支援、絕對準確的 AI 夥伴。</p>
                        <!-- 按鈕：帶光暈效果 -->
                        <a href="#" onclick="showChatView(); return false;" class="btn btn-glow !text-base md:!text-lg !inline-block mt-2 w-full md:w-auto text-center">立即試用 BlinkAI 助理</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- 核心技術 (Technology) -->
        <section id="tech" class="py-16 md:py-24">
            <div class="container mx-auto px-4 md:px-6">
                <h2 class="section-title">BlinkAI 核心技術</h2>
                <p class="section-subtitle">BlinkAI 的準確性來自其嚴謹的雙重技術架構：專有知識庫與 RAG 工作流程。</p>
                <!-- 技術 1: 知識庫 -->
                <div class="grid md:grid-cols-2 gap-10 md:gap-16 items-center mb-16 md:mb-20">
                    <div>
                        <h3 class="text-2xl md:text-3xl font-bold text-white mb-4">技術 I：BlinkAI 知識庫</h3>
                        <p class="text-base md:text-lg text-gray-300 mb-6">BlinkAI 的強大不在於 LLM，而在於其「專有的知識庫」。我們僅從經過驗證的官方來源獲取資料，建立一個純淨的向量資料庫 (Vector DB)，作為 AI 回答的唯一事實來源。</p>
                        <ul class="list-disc list-inside text-gray-300 space-y-2 text-sm md:text-base">
                            <li>官方新聞稿與專輯介紹</li>
                            <li>《Light Up the Sky》等紀錄片逐字稿</li>
                            <li>Vogue, Billboard 等權威媒體的官方採訪</li>
                            <li>已驗證的巡演數據與歌曲版權資訊</li>
                        </ul>
                    </div>
                    <div>
                        <img src="https://placehold.co/800x600/1f2937/f472b6?text=Knowledgebase"
                            alt="[知識庫示意圖]"
                            class="rounded-2xl shadow-2xl w-full">
                    </div>
                </div>

                <!-- 技術 2: RAG -->
                <div class="grid md:grid-cols-2 gap-10 md:gap-16 items-center">
                    <div class="md:order-2">
                        <h3 class="text-2xl md:text-3xl font-bold text-white mb-4">技術 II：RAG 工作流程</h3>
                        <p class="text-base md:text-lg text-gray-300 mb-6">我們利用 RAG 流程嚴格控制 AI 輸出：</p>
                        <ol class="list-decimal list-inside text-gray-300 space-y-3 text-sm md:text-base">
                            <li><strong>查詢 (Query):</strong> 粉絲提出問題。</li>
                            <li><strong>檢索 (Retrieve):</strong> 系統首先從「Blink 知識庫」中檢索最相關的官方資料。</li>
                            <li><strong>增強 (Augment):</strong> 系統將「官方資料」和「原始問題」打包。</li>
                            <li><strong>生成 (Generate):</strong> 最後才將禮包交給 LLM，並用客製化提示詞指示它「只能根據提供的資料回答」。</li>
                        </ol>
                    </div>
                    <div class="md:order-1">
                        <img src="https://placehold.co/800x600/1f2937/f472b6?text=RAG+Flow"
                            alt="[RAG 流程示意圖]"
                            class="rounded-2xl shadow-2xl w-full">
                    </div>
                </div>
            </div>
        </section>

        <!-- LINE 整合區塊 -->
        <section id="line-integration" class="py-16 md:py-24 bg-gray-900">
            <div class="container mx-auto px-4 md:px-6">
                <div class="glass-card p-8 md:p-12 rounded-3xl border-l-0 md:border-l-8 border-t-8 md:border-t-0 border-[#06C755] max-w-4xl mx-auto">
                    <div class="flex flex-col items-center text-center max-w-3xl mx-auto">
                        <h2 class="text-2xl md:text-3xl font-bold text-white mb-4"><i class="fa-brands fa-line text-[#06C755] mr-3"></i> BlinkAI 在 LINE 上為您服務</h2>
                        <p class="text-gray-300 mb-8 text-base md:text-lg leading-relaxed">
                            不需要下載額外 App。直接在 LINE 上與 BlinkAI 對話，隨時隨地查詢巡演資訊、成員生日或驗證網路謠言。
                        </p>
                        <div class="flex flex-col sm:flex-row gap-4 w-full sm:w-auto">
                            <a href="https://line.me/R/ti/p/@360vgdow" target="_blank" class="btn btn-line text-center px-8 w-full sm:w-auto">
                                <i class="fa-solid fa-user-plus mr-2"></i> 加入好友
                            </a>
                            <button onclick="showChatView(true)" class="btn btn-outline text-white border-white hover:bg-white hover:text-gray-900 px-8 w-full sm:w-auto">
                                <i class="fa-solid fa-mobile-screen mr-2"></i> 預覽 LINE 介面
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 我們的團隊 (Our Team) -->
        <section id="team" class="py-16 md:py-24">
            <div class="container mx-auto px-4 md:px-6">
                <h2 class="section-title">我們的團隊</h2>
                <p class="section-subtitle">BlinkAI 由一群熱情的專業人士打造，致力於解決粉絲痛點。</p>
                <div class="grid md:grid-cols-3 gap-6 md:gap-8">
                    <!-- Cylen C. -->
                    <div class="glass-card p-6 md:p-8 rounded-2xl text-center flex flex-col items-center">
                        <img src="https://placehold.co/200x200/1f2937/f472b6?text=Xuan"
                            alt="[Cylen C. 頭像]"
                            class="w-24 h-24 rounded-full mb-4 border-4 border-primary object-cover">
                        <h3 class="text-xl font-bold text-white">Cylen C.</h3>
                        <p class="text-primary font-semibold mb-2">Project Lead / RAG Architect</p>
                        <p class="text-gray-300 text-sm mb-6 flex-grow">負責專案管理與 RAG 技術架構設計。</p>
                        <a href="https://chenyixuan-cyx.github.io/" target="_blank" class="btn-team">
                            <i class="fa-brands fa-github mr-2"></i> 個人專頁
                        </a>
                    </div>
                    <!-- Coco Y. -->
                    <div class="glass-card p-6 md:p-8 rounded-2xl text-center flex flex-col items-center">
                        <img src="https://placehold.co/200x200/1f2937/f472b6?text=Coco"
                            alt="[Coco Y. 頭像]"
                            class="w-24 h-24 rounded-full mb-4 border-4 border-primary object-cover">
                        <h3 class="text-xl font-bold text-white">Coco Y.</h3>
                        <p class="text-primary font-semibold mb-2">Data & Knowledge Base</p>
                        <p class="text-gray-300 text-sm mb-6 flex-grow">負責官方知識庫搜集、驗證與向量化。</p>
                        <a href="https://yinkoying.github.io/" target="_blank" class="btn-team">
                            <i class="fa-brands fa-github mr-2"></i> 個人專頁
                        </a>
                    </div>
                    <!-- Maggie C. -->
                    <div class="glass-card p-6 md:p-8 rounded-2xl text-center flex flex-col items-center">
                        <img src="https://placehold.co/200x200/1f2937/f472b6?text=Maggie"
                            alt="[Maggie C. 頭像]"
                            class="w-24 h-24 rounded-full mb-4 border-4 border-primary object-cover">
                        <h3 class="text-xl font-bold text-white">Maggie C.</h3>
                        <p class="text-primary font-semibold mb-2">Business & Marketing</p>
                        <p class="text-gray-300 text-sm mb-6 flex-grow">負責商業模式規劃與市場客群分析。</p>
                        <a href="https://chenchinghsuan.github.io/" target="_blank" class="btn-team">
                            <i class="fa-brands fa-github mr-2"></i> 個人專頁
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- 定價方案 (Pricing) -->
        <section id="pricing" class="py-16 md:py-24 gradient-bg">
            <div class="container mx-auto px-4 md:px-6">
                <h2 class="section-title">選擇適合你的方案</h2>
                <p class="section-subtitle">從免費開始，或升級以獲得無限可能。</p>
                <div class="grid md:grid-cols-3 gap-6 md:gap-8 max-w-5xl mx-auto">
                    <!-- 方案 1: Freemium -->
                    <div class="glass-card p-6 md:p-8 rounded-2xl border-2 border-gray-700 flex flex-col order-2 md:order-1">
                        <h3 class="text-xl md:text-2xl font-bold text-white text-center mb-2">Freemium</h3>
                        <p class="text-gray-400 text-center mb-6 text-sm">適合輕度使用者</p>
                        <p class="text-4xl md:text-5xl font-extrabold text-white text-center mb-6">$0<span class="text-base md:text-lg text-gray-400"> USD</span></p>
                        <ul class="space-y-3 text-gray-300 mb-8 flex-grow text-sm md:text-base">
                            <li class="flex items-center"><i class="fa-solid fa-check text-primary mr-3"></i> 每日 10 次免費查詢</li>
                            <li class="flex items-center"><i class="fa-solid fa-check text-primary mr-3"></i> 存取標準知識庫</li>
                        </ul>
                        <!-- 按鈕：光暈效果 + 連接 AI -->
                        <a href="#" onclick="showChatView(); return false;" class="w-full text-center btn btn-glow">立即開始</a>
                    </div>
                    <!-- 方案 2: Blink Plus -->
                    <div class="glass-card p-6 md:p-8 rounded-2xl border-2 border-primary flex flex-col shadow-2xl relative order-1 md:order-2 transform scale-105 md:scale-100">
                        <span class="absolute top-0 -translate-y-1/2 left-1/2 -translate-x-1/2 bg-primary text-gray-900 text-xs md:text-sm font-bold px-4 py-1 rounded-full">最受歡迎</span>
                        <h3 class="text-xl md:text-2xl font-bold text-primary text-center mb-2">Blink Plus</h3>
                        <p class="text-gray-400 text-center mb-6 text-sm">適合資深粉絲</p>
                        <p class="text-4xl md:text-5xl font-extrabold text-white text-center mb-6">$9.99<span class="text-base md:text-lg text-gray-400"> / 月</span></p>
                        <ul class="space-y-3 text-gray-300 mb-8 flex-grow text-sm md:text-base">
                            <li class="flex items-center"><i class="fa-solid fa-check text-primary mr-3"></i> <strong>無限次</strong> 查詢</li>
                            <li class="flex items-center"><i class="fa-solid fa-check text-primary mr-3"></i> 知識庫即時更新</li>
                            <li class="flex items-center"><i class="fa-solid fa-check text-primary mr-3"></i> LINE 平台支援</li>
                        </ul>
                        <!-- 按鈕：連接至註冊頁面 -->
                        <a href="#" onclick="showSignupView(); return false;" class="w-full text-center btn btn-primary font-bold">立即升級</a>
                    </div>
                    <!-- 方案 3: Media API -->
                    <div class="glass-card p-6 md:p-8 rounded-2xl border-2 border-gray-700 flex flex-col order-3">
                        <h3 class="text-xl md:text-2xl font-bold text-white text-center mb-2">Media API</h3>
                        <p class="text-gray-400 text-center mb-6 text-sm">適合企業</p>
                        <p class="text-3xl md:text-4xl font-extrabold text-white text-center mb-6">企業報價</p>
                        <ul class="space-y-3 text-gray-300 mb-8 flex-grow text-sm md:text-base">
                            <li class="flex items-center"><i class="fa-solid fa-check text-primary mr-3"></i> API 存取權限</li>
                            <li class="flex items-center"><i class="fa-solid fa-check text-primary mr-3"></i> B2B 趨勢報告</li>
                        </ul>
                        <!-- 按鈕：明顯邊框 + 指定 Email -->
                        <a href="mailto:ecoshane.esg@gmail.com" class="w-full text-center btn btn-outline-bright">聯繫我們</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="py-8 md:py-12 bg-gray-900 mt-auto">
            <div class="container mx-auto px-6 text-center text-gray-400 text-sm md:text-base">
                <p class="text-2xl font-bold text-primary mb-4">BlinkAI</p>
                <div class="flex flex-col md:flex-row justify-center gap-4 md:gap-6 mb-4">
                    <a href="#solution" class="hover:text-primary">解決方案</a>
                    <a href="#tech" class="hover:text-primary">核心技術</a>
                    <a href="#pricing" class="hover:text-primary">定價方案</a>
                </div>
                <p>&copy; 2025 BlinkAI. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <!-- 2. AI 助理視圖 (Chat Assistant) -->
    <div id="chat-assistant" class="hidden min-h-screen">
        <!-- 針對手機版優化的 Container，使用 dvh 確保全螢幕 -->
        <div class="container mx-auto max-w-3xl h-full flex flex-col p-4 md:p-12 min-h-[100dvh]">
            <!-- 頂部導航 -->
            <div id="web-nav-controls" class="flex flex-col md:flex-row md:items-center justify-between mb-4 md:mb-8 gap-4">
                <div class="flex items-center justify-between w-full md:w-auto">
                    <h1 class="text-2xl md:text-3xl font-bold text-primary">BlinkAI 助理</h1>
                    <a href="#" onclick="showLandingView(); return false;" class="md:hidden text-gray-400 hover:text-primary text-sm">返回官網</a>
                </div>
                <div class="flex items-center gap-4 self-end md:self-auto">
                    <!-- LINE 模式切換按鈕 -->
                    <button onclick="toggleLineMode()" class="text-xs md:text-sm px-3 py-1 border border-gray-600 rounded-full text-gray-400 hover:text-[#06C755] hover:border-[#06C755] transition">
                        <i class="fa-brands fa-line mr-1"></i> 切換介面
                    </button>
                    <a href="#" onclick="showLandingView(); return false;" class="hidden md:inline text-gray-400 hover:text-primary transition-colors">&larr; 返回官網</a>
                </div>
            </div>
            <p id="web-intro" class="text-gray-400 text-center mb-4 md:mb-10 text-sm md:text-base px-2">
                您可以問我任何關於 BLACKPINK 的問題。<br class="hidden md:inline">
                試著問：<strong class="text-white">「BLACKPINK 的隊長是誰？」</strong>
            </p>
            <!-- 聊天室窗口 -->
            <!-- 使用 flex-1 讓它佔據剩餘空間，手機版高度調整 -->
            <div class="glass-card rounded-2xl shadow-2xl overflow-hidden flex flex-col flex-1 md:h-[70vh] max-h-[80dvh] md:max-h-none">
                <!-- 聊天室頭部 -->
                <div class="chat-header p-3 md:p-4 bg-gray-900/50 border-b border-gray-700 relative flex-shrink-0 justify-center">
                    <!-- 新增：左側返回箭頭 (LINE 模式專用) -->
                    <button id="line-back-btn" onclick="showLandingView()" class="absolute left-4 text-white hidden">
                            <i class="fa-solid fa-chevron-left text-xl"></i>
                    </button>

                    <h2 class="text-lg md:text-2xl font-bold text-white text-center">BlinkAI 助理</h2>

                    <!-- 原有的關閉按鈕 (可保留作為備用) -->
                    <button class="text-gray-400 hover:text-gray-600 absolute right-4 top-1/2 -translate-y-1/2 hidden p-2" id="close-line-btn" onclick="toggleLineMode()">
                        <i class="fa-solid fa-xmark text-xl"></i>
                    </button>
                </div>
                <!-- 聊天內容 -->
                <div id="chat-content" class="p-4 md:p-8 space-y-4 md:space-y-6 flex-1 overflow-y-auto bg-transparent">
                    <!-- 初始歡迎訊息 -->
                    <div class="chat-bubble ai-bubble">
                        <p class="font-bold"><i class="fa-solid fa-check-circle mr-2"></i> BlinkAI 助理：</p>
                        <p>您好！我是 BlinkAI 助理。我可以根據專門的官方知識庫，回答您任何關於 BLACKPINK 的問題。</p>
                        <p class="mt-2">試著問我：「隊長是誰？」</p>
                    </div>
                </div>
                <!-- 載入中指示器 -->
                <div id="loading-indicator" class="p-2 text-center text-gray-400 hidden flex-shrink-0">
                    <div class="loading-dots">
                        <span></span><span></span><span></span>
                    </div>
                    <span class="ml-2 text-xs md:text-sm">BlinkAI 正在思考中...</span>
                </div>
                <!-- 輸入框 -->
                <form id="chat-form" class="p-3 md:p-4 bg-gray-900/50 border-t border-gray-700 flex-shrink-0">
                    <div class="flex items-center p-2 md:p-3 rounded-full bg-gray-800 border border-gray-700">
                        <input
                            type="text"
                            id="chat-input"
                            placeholder="輸入您的問題..."
                            class="bg-transparent text-white w-full focus:outline-none ml-2 text-base"
                            autocomplete="off"
                        >
                        <button
                            type="submit"
                            id="send-button"
                            class="bg-primary text-gray-900 rounded-full w-8 h-8 md:w-10 md:h-10 flex items-center justify-center ml-2 flex-shrink-0 transition-transform duration-200 hover:scale-110 active:scale-95"
                        >
                            <i class="fa-solid fa-paper-plane text-sm md:text-base"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 3. 會員註冊視圖 (Signup View) - 新增 -->
    <div id="signup-view" class="hidden min-h-screen bg-gray-900 flex flex-col items-center justify-center p-6">
        <div class="w-full max-w-md">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-primary mb-2">加入 BlinkAI</h2>
                <p class="text-gray-400">註冊 Blink Plus，解鎖無限次查詢。</p>
            </div>

            <div class="glass-card p-8 rounded-2xl shadow-2xl border border-gray-700">
                <form onsubmit="event.preventDefault(); showTemporaryMessage('註冊功能開發中！先讓您試用 AI 助理。'); showChatView();">
                    <div class="mb-4">
                        <label class="block text-gray-300 text-sm font-bold mb-2" for="username">暱稱</label>
                        <input class="input-field" id="username" type="text" placeholder="您的 Blink 暱稱" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-300 text-sm font-bold mb-2" for="email">Email</label>
                        <input class="input-field" id="email" type="email" placeholder="name@example.com" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-300 text-sm font-bold mb-2" for="password">密碼</label>
                        <input class="input-field" id="password" type="password" placeholder="設定密碼" required>
                    </div>
                    <button type="submit" class="w-full btn btn-glow rounded-lg py-3 text-lg font-bold mb-4">
                        註冊帳號
                    </button>
                </form>
                <div class="text-center mt-4">
                    <a href="#" onclick="showLandingView(); return false;" class="text-gray-400 hover:text-primary text-sm">
                        <i class="fa-solid fa-arrow-left mr-1"></i> 返回首頁
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- 4. JavaScript 邏輯 -->
    <script type="module">
    /* ------------------------- CANVAS 粒子動畫邏輯 ------------------------- */
    const canvas = document.getElementById('heroCanvas');
    const ctx = canvas ? canvas.getContext('2d') : null;
    const particles = [];
    const particleCount = 75; // 粒子數量
    const mouse = { x: null, y: null, radius: 100 };

    // 粒子顏色：粉色 (Primary)、白色 (Neutral)、深灰 (Secondary)
    const colors = ['#f472b6', '#ffffff', '#1f2937'];

    if (canvas && ctx) {
        // 調整 Canvas 尺寸
        function resizeCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // 追蹤滑鼠位置 (用於互動)
        window.addEventListener('mousemove', (event) => {
            // 修正座標為相對於 Canvas 頂部
            const rect = canvas.getBoundingClientRect();
            mouse.x = event.clientX - rect.left;
            mouse.y = event.clientY - rect.top;
        });

        // 粒子類別
        class Particle {
            constructor(x, y, directionX, directionY, size, color) {
                this.x = x;
                this.y = y;
                // 確保粒子移動緩慢
                this.directionX = directionX * 0.5;
                this.directionY = directionY * 0.5;
                this.size = size;
                this.color = color;
            }

            // 繪製粒子
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2, false);
                ctx.fillStyle = this.color;
                ctx.fill();
            }

            // 更新位置和檢查互動
            update() {
                // 粒子碰撞邊界反彈
                if (this.x > canvas.width || this.x < 0) this.directionX = -this.directionX;
                if (this.y > canvas.height || this.y < 0) this.directionY = -this.directionY;

                this.x += this.directionX;
                this.y += this.directionY;

                // 檢查滑鼠互動
                if (mouse.x !== null) {
                    let dx = mouse.x - this.x;
                    let dy = mouse.y - this.y;
                    let distance = Math.sqrt(dx*dx + dy*dy);

                    if (distance < mouse.radius) {
                        this.size = 2; // 靠近時變大
                        this.color = '#f9a8d4'; // 靠近時變成淺粉色
                    } else {
                        // 恢復大小和顏色
                        this.size = Math.random() * 2 + 0.5;
                        this.color = colors[Math.floor(Math.random() * colors.length)];
                    }
                }

                this.draw();
            }
        }

        // 創建粒子陣列
        function initParticles() {
            for (let i = 0; i < particleCount; i++) {
                let size = Math.random() * 2 + 0.5;
                let x = Math.random() * (canvas.width - size * 2) + size;
                let y = Math.random() * (canvas.height - size * 2) + size;
                let directionX = (Math.random() * 1) - 0.5; // 速度範圍 -0.5 到 0.5
                let directionY = (Math.random() * 1) - 0.5;
                let color = colors[Math.floor(Math.random() * colors.length)];

                particles.push(new Particle(x, y, directionX, directionY, size, color));
            }
        }

        // 繪製動畫循環
        function animate() {
            requestAnimationFrame(animate);
            ctx.clearRect(0, 0, canvas.width, canvas.height); // 清除上一幀

            for (let i = 0; i < particles.length; i++) {
                particles[i].update();
            }

            // 繪製粒子之間的線條
            for (let a = 0; a < particles.length; a++) {
                for (let b = a; b < particles.length; b++) {
                    let distance = Math.sqrt(
                        Math.pow(particles[a].x - particles[b].x, 2) +
                        Math.pow(particles[a].y - particles[b].y, 2)
                    );

                    if (distance < 70) { // 粒子夠近時連線
                        ctx.strokeStyle = `rgba(244, 114, 182, ${1 - (distance/70)})`; // 距離越近，線條越不透明
                        ctx.lineWidth = 0.5;
                        ctx.beginPath();
                        ctx.moveTo(particles[a].x, particles[a].y);
                        ctx.lineTo(particles[b].x, particles[b].y);
                        ctx.stroke();
                    }
                }
            }
        }

        // 確保在視窗載入完成後啟動動畫
        window.onload = function() {
            initParticles();
            animate();
        }
    }

    /* ------------------------- 視圖切換邏輯 ------------------------- */
    const landingPage = document.getElementById('landing-page');
    const chatAssistant = document.getElementById('chat-assistant');
    const signupView = document.getElementById('signup-view');
    const body = document.body;
    let isLineMode = false;

    // 替代 alert() 的臨時訊息顯示
    function showTemporaryMessage(message) {
        const tempAlert = document.createElement('div');
        tempAlert.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-red-600 text-white px-4 py-2 rounded-lg shadow-xl z-[1000] opacity-0 transition-opacity duration-300';
        tempAlert.textContent = message;
        document.body.appendChild(tempAlert);

        // 顯示
        setTimeout(() => tempAlert.style.opacity = '1', 10);

        // 隱藏並移除
        setTimeout(() => {
            tempAlert.style.opacity = '0';
            setTimeout(() => tempAlert.remove(), 300);
        }, 3000);
    }
    window.showTemporaryMessage = showTemporaryMessage; // 暴露給全局

    window.toggleMobileMenu = function() {
        const menu = document.getElementById('mobile-menu');
        menu.classList.toggle('open');
        if (menu.classList.contains('hidden')) {
            menu.classList.remove('hidden');
            setTimeout(() => menu.classList.add('open'), 10);
        } else {
            menu.classList.remove('open');
            setTimeout(() => menu.classList.add('hidden'), 300);
        }
    }

    window.showLandingView = function () {
        landingPage.classList.remove('hidden');
        chatAssistant.classList.add('hidden');
        signupView.classList.add('hidden');
        window.scrollTo(0, 0);
        if (isLineMode) toggleLineMode();
    }

    window.showChatView = function (startLineMode = false) {
        landingPage.classList.add('hidden');
        chatAssistant.classList.remove('hidden');
        signupView.classList.add('hidden');
        window.scrollTo(0, 0);

        if (startLineMode && !isLineMode) {
            toggleLineMode();
        }
    }

    window.showSignupView = function () {
        landingPage.classList.add('hidden');
        chatAssistant.classList.add('hidden');
        signupView.classList.remove('hidden');
        window.scrollTo(0, 0);
    }

    // --- LINE 模式切換 ---
    window.toggleLineMode = function() {
        isLineMode = !isLineMode;
        const navControls = document.getElementById('web-nav-controls');
        const intro = document.getElementById('web-intro');
        const headerTitle = document.querySelector('.chat-header h2');
        const closeBtn = document.getElementById('close-line-btn');
        const backBtn = document.getElementById('line-back-btn');
        const containerDiv = document.querySelector('#chat-assistant .container');

        if (isLineMode) {
            body.classList.add('line-mode');
            navControls.style.display = 'none';
            intro.style.display = 'none';
            headerTitle.innerText = 'BlinkAI (官方帳號)';
            closeBtn.classList.add('hidden');
            backBtn.classList.remove('hidden');

            // 強制全螢幕配置
            containerDiv.classList.remove('p-4', 'md:p-12');
            containerDiv.classList.add('!p-0', '!max-w-full');
        } else {
            body.classList.remove('line-mode');
            navControls.style.display = 'flex';
            intro.style.display = 'block';
            headerTitle.innerText = 'BlinkAI 助理';
            closeBtn.classList.add('hidden');
            backBtn.classList.add('hidden');

            // 恢復一般配置
            containerDiv.classList.add('p-4', 'md:p-12');
            containerDiv.classList.remove('!p-0', '!max-w-full');
        }
    }

    /* ------------------------- 聊天室功能邏輯 (真實 API) ------------------------- */

    // DOM 元素
    const chatContent = document.getElementById('chat-content');
    const chatForm = document.getElementById('chat-form');
    const chatInput = document.getElementById('chat-input');
    const sendButton = document.getElementById('send-button');
    const loadingIndicator = document.getElementById('loading-indicator');

    // **重要：API 配置 - 指向您的 Flask 後端**
    const API_BASE_URL = "https://9e401e4bfbde.ngrok-free.app";
    const API_CHAT_ENDPOINT = `${API_BASE_URL}/api/chat`;

    if (chatForm) {
        chatForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const queryText = chatInput.value.trim();
            if (!queryText) return;

            // 確保手機鍵盤跳出時能看到對話
            setTimeout(() => {
                chatContent.lastElementChild?.scrollIntoView({behavior: "smooth"});
            }, 100);

            addMessageToChat('user', '粉絲提問：', queryText);
            chatInput.value = "";
            handleAPIRequest(queryText); // 呼叫真實 API
        });
    }

    // **新的 API 請求函式**
    async function handleAPIRequest(query) {
        setLoading(true);
        const MAX_RETRIES = 5;

        for (let attempt = 0; attempt < MAX_RETRIES; attempt++) {
            try {
                const response = await fetch(API_CHAT_ENDPOINT, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ query: query })
                });

                if (response.status === 429 && attempt < MAX_RETRIES - 1) {
                    await new Promise(r => setTimeout(r, Math.pow(2, attempt) * 1000));
                    continue; // 重試
                }

                if (!response.ok) {
                    throw new Error(`HTTP Error! Status: ${response.status}`);
                }

                const result = await response.json();

                if (result.success) {
                    // 成功獲取 RAG 回答
                    // 整理來源資訊：將 sources 陣列轉換為單一字串
                    const sourceText = result.sources.map(s => `${s.source} (${s.category})`).join(' | ');
                    addMessageToChat('ai', 'BlinkAI 助理：', result.answer, sourceText || '知識庫未提供特定來源');
                } else {
                    // 後端回傳失敗訊息
                    addMessageToChat('ai', 'BlinkAI 助理 (錯誤)：', `連線錯誤: ${result.error || '未知錯誤'}`, null, 'error');
                }
                break; // 成功或處理完畢，退出循環
            } catch (error) {
                console.error("API 請求失敗:", error);
                if (attempt === MAX_RETRIES - 1) {
                    addMessageToChat('ai', 'BlinkAI 助理 (錯誤)：', '抱歉，無法連線到後端伺服器。請確認您的後端（ngrok/Flask）是否正在運行並公開。', null, 'error');
                }
                // 如果不是最後一次嘗試，則會進入下一個循環 (指數退避)
            }
        }
        setLoading(false);
    }

    function addMessageToChat(role, sender, text, source = null, type = 'normal') {
        const bubble = document.createElement('div');
        bubble.classList.add('chat-bubble');

        let bubbleClasses = [];
        let iconHtml = '';

        if (role === 'user') {
            bubbleClasses.push('user-bubble');
            iconHtml = `<i class="fa-solid fa-user mr-2"></i>`;
        } else {
            bubbleClasses.push('ai-bubble');
            if (type === 'error') {
                bubbleClasses.push('ai-bubble-error');
                iconHtml = `<i class="fa-solid fa-triangle-exclamation mr-2"></i>`;
            } else if (source) {
                iconHtml = `<i class="fa-solid fa-check-circle mr-2"></i>`;
            } else {
                iconHtml = `<i class="fa-solid fa-robot mr-2"></i>`;
            }
        }

        bubble.classList.add(...bubbleClasses);
        const formattedText = text.replace(/\n/g, "<br>");

        // LINE 模式下不顯示發送者名字
        const senderHtml = `<p class="font-bold ${isLineMode ? 'hidden' : ''}">${iconHtml} ${sender}</p>`;

        let sourceHtml = "";
        // 只有在非錯誤模式下，且有來源時才顯示
        if (source && type !== 'error') {
            sourceHtml = `
            <div class="source">
                <p class="source-title"><i class="fa-solid fa-link mr-1"></i> 引用來源：</p>
                <p class="truncate">${source}</p>
            </div>`;
        }

        bubble.innerHTML = `
            ${senderHtml}
            <p class="mt-1 md:mt-2">${formattedText}</p>
            ${sourceHtml}
        `;

        chatContent.appendChild(bubble);
        chatContent.scrollTop = chatContent.scrollHeight;
    }

    function setLoading(isLoading) {
        if (isLoading) {
            loadingIndicator.classList.remove("hidden");
            chatInput.disabled = true;
            sendButton.disabled = true;
        } else {
            loadingIndicator.classList.add("hidden");
            chatInput.disabled = false;
            sendButton.disabled = false;
            // 防止手機鍵盤收起後失焦
            if (window.innerWidth > 768) chatInput.focus();
        }
        chatContent.scrollTop = chatContent.scrollHeight;
    }

    // 初始狀態
    showLandingView();
    </script>
</body>
</html>
